syntax = "proto3";

package metalstack.admin.v2;

import "buf/validate/validate.proto";
import "metalstack/api/v2/common.proto";
import "metalstack/api/v2/filesystem.proto";
import "metalstack/api/v2/predefined_rules.proto";

// FilesystemService serves filesystem related functions
service FilesystemService {
  // Create a filesystem
  rpc Create(FilesystemServiceCreateRequest) returns (FilesystemServiceCreateResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
    option (metalstack.api.v2.auditing) = AUDITING_INCLUDED;
  }
  // Update a filesystem
  rpc Update(FilesystemServiceUpdateRequest) returns (FilesystemServiceUpdateResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
    option (metalstack.api.v2.auditing) = AUDITING_INCLUDED;
  }
  // Delete a filesystem
  rpc Delete(FilesystemServiceDeleteRequest) returns (FilesystemServiceDeleteResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
    option (metalstack.api.v2.auditing) = AUDITING_INCLUDED;
  }
}

// FilesystemServiceCreateRequest
message FilesystemServiceCreateRequest {
  // FilesystemLayout the filesystemlayout
  metalstack.api.v2.FilesystemLayout filesystem_layout = 1;
}

// FilesystemServiceCreateResponse
message FilesystemServiceCreateResponse {
  // FilesystemLayout the filesystemlayout
  metalstack.api.v2.FilesystemLayout filesystem_layout = 1;
}

// FilesystemServiceUpdateRequest
message FilesystemServiceUpdateRequest {
  // Id of this filesystemLayout
  string id = 1 [(buf.validate.field).string = {
    min_len: 2
    max_len: 128
  }];
  // UpdateMeta contains the timestamp and strategy to be used in this update request
  metalstack.api.v2.UpdateMeta update_meta = 2 [(buf.validate.field).required = true];
  // Name of this filesystemLayout
  optional string name = 3 [(buf.validate.field).string.(metalstack.api.v2.is_name) = true];
  // Description of this filesystemLayout
  optional string description = 4 [(buf.validate.field).string.(metalstack.api.v2.is_description) = true];
  // Filesystems is a list of filesystems to create on a machine
  repeated metalstack.api.v2.Filesystem filesystems = 5;
  // Disks list of disks that belong to this layout
  repeated metalstack.api.v2.Disk disks = 6;
  // raid arrays to create
  repeated metalstack.api.v2.Raid raid = 7;
  // VolumeGroups list of volumegroups to create
  repeated metalstack.api.v2.VolumeGroup volume_groups = 8;
  // LogicalVolumes list of logicalvolumes to create
  repeated metalstack.api.v2.LogicalVolume logical_volumes = 9;
  // Constraints which must match that this layout is taken, if sizes and images are empty these are develop layouts
  metalstack.api.v2.FilesystemLayoutConstraints constraints = 10;
}

// FilesystemServiceUpdateResponse
message FilesystemServiceUpdateResponse {
  // FilesystemLayout the filesystemlayout
  metalstack.api.v2.FilesystemLayout filesystem_layout = 1;
}

// FilesystemServiceDeleteRequest
message FilesystemServiceDeleteRequest {
  // ID of the filesystem to delete
  string id = 1 [(buf.validate.field).string = {
    min_len: 2
    max_len: 128
  }];
}

// message FilesystemServiceDeleteResponse {
message FilesystemServiceDeleteResponse {
  // FilesystemLayout the filesystemlayout
  metalstack.api.v2.FilesystemLayout filesystem_layout = 1;
}
