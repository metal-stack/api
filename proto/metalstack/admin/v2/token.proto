syntax = "proto3";

package metalstack.admin.v2;

import "buf/validate/validate.proto";
import "metalstack/api/v2/common.proto";
import "metalstack/api/v2/token.proto";

// TokenService serves token related functions
service TokenService {
  // List tokens
  rpc List(TokenServiceListRequest) returns (TokenServiceListResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_VIEWER;
  }
  // Revoke a token
  rpc Revoke(TokenServiceRevokeRequest) returns (TokenServiceRevokeResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
  }
  // Create a token to authenticate against the platform, the secret will be only visible in the response.
  // This service is suitable to create tokens with admin permissions.
  rpc Create(TokenServiceCreateRequest) returns (TokenServiceCreateResponse) {
    option (metalstack.api.v2.admin_roles) = ADMIN_ROLE_EDITOR;
  }
}

// TokenServiceListRequest is the request payload for the token list request
message TokenServiceListRequest {
  // User is the id of the user for which the tokens should be listed
  optional string user = 1;
}

// TokenServiceListResponse is the response payload for the token list request
message TokenServiceListResponse {
  // Tokens is the list of tokens
  repeated metalstack.api.v2.Token tokens = 1;
}

// TokenServiceRevokeRequest is the request payload for the token revoke request
message TokenServiceRevokeRequest {
  // Uuid is the uuid of the token which should be revoked
  string uuid = 1 [(buf.validate.field).string.uuid = true];
  // User is the id of the user for which the token should be revoked
  string user = 2 [(buf.validate.field).string = {
    min_len: 2
    max_len: 512
  }];
}

// TokenServiceRevokeResponse is the response payload for the token revoke request
message TokenServiceRevokeResponse {}

// TokenServiceCreateRequest is the request payload to create a token
message TokenServiceCreateRequest {
  // User this token should be created for, if omitted, user is derived from caller
  optional string user = 1 [(buf.validate.field).string = {
    min_len: 2
    max_len: 512
  }];
  // Token which was should be created
  metalstack.api.v2.Token token = 2;
}

// TokenServiceCreateResponse is the response payload of a token create request
message TokenServiceCreateResponse {
  // Token which was created
  metalstack.api.v2.Token token = 1;
  // Secret is the body if the jwt token, should be used in api requests as bearer token
  string secret = 2;
}
